sequenceDiagram
    participant DS as Data Sources
    participant Kafka as Kafka Stream
    participant SP as Stream Processor
    participant NLP as NLP Engine
    participant GDB as Graph Database
    participant GNN as Graph Neural Net
    participant Cache as Vector Cache
    participant Analyst as AI Analyst

    Note over DS,Analyst: Real-Time Context Graph Update Flow

    %% Event Ingestion
    DS->>Kafka: 1. New Event<br/>(e.g., "NVDA announces<br/>new AI chip")
    Kafka->>SP: 2. Stream event

    %% Stream Processing
    SP->>NLP: 3. Extract entities & intent
    NLP-->>SP: 4. Entities: NVDA, AI Chip, Market

    %% Graph Update
    SP->>GDB: 5. Update relationships
    GDB-->>SP: 6. Graph mutation complete

    %% Graph Intelligence
    GDB->>GNN: 7. Trigger neighborhood embedding
    GNN-->>Cache: 8. Store updated vectors

    %% Cache Update
    Cache-->>GDB: 9. Sync embeddings

    %% Downstream Notification
    Cache->>Analyst: 10. Context updated<br/>Affected entities: 47

    %% Analyst Query
    rect rgb(40, 40, 120)
        Note over Analyst:
            Query:<br/>
            "How does NVDA's announcement affect AI stocks?"<br/><br/>
            ✓ Sector momentum shift<br/>
            ✓ Historical pattern matches
    end

    Analyst->>GDB: 11. Query enriched context
    GDB-->>Analyst: 12. Return augmented data<br/>+ embeddings + scenarios

    Analyst->>Analyst: 13. Generate investment thesis

    Note over DS,Analyst: ⏱️ Total latency: 500ms – 2s for complete update
